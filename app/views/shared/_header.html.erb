<% current_user_recruit = current_user.recruit? %>
<% current_user_entry = current_user.entry? %>

<header>
  <div class="header-wrap">
    <div class="left">
      <%= link_to "instakt", root_path %>
      <% if page_name.present? %>
        <span><%= page_name %></span>
      <% end %>
    </div>

    <div class="right">
      <% if user_signed_in? %> <%# ログイン状態であれば %>
        <% if current_user.matchers.length > 0 && current_page?(recruitments_path) %> <%# フレンドが1人以上かつ、現在のページが募集一覧であれば %>
          <% if current_user_recruit %> <%# 募集中であれば %>
            <%= link_to "マイ募集ルーム", recruitment_path(current_user_recruit), class: "btn header-btn" %>
          <% elsif current_user_entry %> <%# 参加していれば %>
            <%= link_to "参加中のルーム", recruitment_path(current_user_entry.recruit), class: "btn header-btn" %>
          <% else %> <%# 募集も参加もしていなければ %>
            <div class="new-recruit-wrap">
              <div class="btn header-btn" id="modal_btn">募集する</div>
              <ul class="menu-list" id="btn-menu">
                <li class="menu" id="recruit-later">これから</li>
                <li class="menu" id="recruit-now">いま</li>
              </ul>
            </div>
          <% end %>
        <% end %>
        <% if current_user_recruit && current_page?(recruitment_path(current_user_recruit)) %> <%# 現在のページがマイ募集ルームであれば %>
          <div class="new-recruit-wrap">
            <i class="fas fa-cog header-config" id="modal_btn"></i>
            <ul class="menu-list" id="btn-menu">
              <li class="menu">募集内容</li>
              <li class="menu">募集編集</li>
              <% if current_user_recruit.close? %>  <%# 募集が終了している場合 %>
                <div class="menu" id="header-close" data-status="restart">募集再開</div>
              <% else %>  <%# 募集が終了していない場合 %>
                <div class="menu" id="header-close" data-status="close">募集終了</div>
              <% end %>
              <%= link_to "募集削除", recruitments_destroy_path, method: :delete, class: "menu" %>
            </ul>
          </div>
        <% end %>
        <% if current_user_entry && current_page?(recruitment_path(current_user_entry.recruit)) %> <%# 現在のページが参加中のルームであれば %>
          <div class="new-recruit-wrap">
            <i class="fas fa-cog header-config" id="modal_btn"></i>
            <ul class="menu-list" id="btn-menu">
              <li class="menu">募集内容</li>
              <%= link_to "参加取り消し", recruitment_entries_path(current_user_entry.recruit), method: :delete, class: "menu" %>
            </ul>
          </div>
        <% end %>
        <div class="user-icon-wrap">
          <%= image_tag current_user.image.variant(combine_options:{gravity: :center, resize:"50x50^", crop:"50x50+0+0"}).processed, id: "user-icon" %>
          <div class="menu-list" id="user-menu">
            <%= link_to "プロフィール", profile_path, class: "menu" %>
            <%= link_to "フレンド", friends_path, class: "menu" %>
            <%= link_to "ログアウト", destroy_user_session_path, method: :delete, class: "menu" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%= render 'shared/flash_messages' %>
</header>